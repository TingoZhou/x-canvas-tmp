var fs = require("fs");

var loader;

var script = function(path) {
  eval(fs.readFileSync(path, "utf8"));
};

module.exports = {
  init: function(path) {
    script(path + "/xc.js");
    xc.ld.path.addPaths({
      root: path
    });
    loader = new xc.ld.Loader({
      loadScript: function(path) {
        if (!loader.modules) {
          loader.modules = [];
        }
        loader.modules.push(path);
        loader.more();
      },
      loadPackage: function(path) {
        script(path);
        loader.more();
      }
    });
    xc.depends = function() {
      loader.load.apply(loader, arguments);
    };
  },
  walk: function(path, callback) {
    loader.load([path], function() {
      callback(loader);
    });
  }
};
