<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>EaselJS 示例: SpriteSheetBuilder</title>

	<link href="assets/demoStyles.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="../../../src/xc.js"></script>

    <script>
    xc.depends([
        "../../../src/core",
        "../../../src/lib/createjs"
    ], function() {
		var canvas;
		var stage;
	
		function init() {
			//保存canvas和stage实例，并等待图片加载完毕
			canvas = document.getElementById("testCanvas");
			stage = new createjs.Stage(canvas);
			
			// 设置一对显示对象，作为资源，并把它们添加到场景
			var circle = new createjs.Shape();
			circle.graphics.beginFill("#F00").drawCircle(0,0,30).beginFill("#C00").drawCircle(0,0,10);
			circle.setTransform(100,90);
			
			var square = new createjs.Container();
			var squareBg = square.addChild(new createjs.Shape());
			squareBg.graphics.beginFill("#00F").drawRect(0,0,80,80);
			var squareFld = square.addChild(new createjs.Text("1", "bold 72px Arial", "#9BF"));
			squareFld.textBaseline = "top";
			squareFld.textAlign = "center";
			squareFld.x = 40;
			square.setTransform(150,50);
			// 我们会定义这个形状的有效范围，当调用addFrame时会使用到
			square.bounds = new createjs.Rectangle(0,0,80,80);
			
			stage.addChild(circle, square);
			
			// create the sprite sheet builder:
			var builder = new createjs.SpriteSheetBuilder();
			
			// add the circle as a frame, specify the bounds to draw, and grab the frame index:
			var index = builder.addFrame(circle, new createjs.Rectangle(-30,-30,60,60));
			// add a named animation using the frame index:
			builder.addAnimation("circle", index);
			
			// add the square as a sequence of frames, each with a different number in the text field:
			var frames = [];
			for (var i=0; i<5; i++) {
				// we're defining a setup function that will update the text before each frame draw.
				// the setup function will be called right before the draw, and passed the setup params "[i]":
				index = builder.addFrame(square, null, 1, function(num) { squareFld.text=num; }, [i]);
				// save off the index of each frame in order to use when defining the animation:
				frames.push(index);
			}
			// create an animation named square that comprises all of the frames we just added:
			// we're also telling it to loop the animation and setting a frequency so it updates every 8 ticks:
			builder.addAnimation("square", frames, true, 8);
			
			// run the build operation, and grab the resulting sprite sheet:
			// we could also do this asynchronously with buildAsync(...)
			var spriteSheet = builder.build();
			
			// create our bitmap animations using the generated sprite sheet, and put them on stage:
			var circle2 = new createjs.BitmapAnimation(spriteSheet);
			circle2.gotoAndPlay("circle");
			circle2.setTransform(100,90+100);
			stage.addChild(circle2);
			
			var square2 = new createjs.BitmapAnimation(spriteSheet);
			square2.gotoAndPlay("square");
			square2.setTransform(150,50+100);
			stage.addChild(square2);
			
			// append the generated spritesheet image for demo purposes:
			document.body.appendChild(spriteSheet._images[0]);
			
			// we want to do some work before we update the canvas,
			// otherwise we could use Ticker.addEventListener("tick", stage);
			createjs.Ticker.addEventListener("tick", tick);
		}
	
	    function tick() {
	        stage.update();
	    }
	    init();
    });
	</script>
</head>
	
<body>

	<header id="header" class="EaselJS">
	    <h1><span class="text-product">Easel<strong>JS</strong></span> SpriteSheetBuilder示例</h1>
	    <p>使用 <strong>SpriteSheetBuilder</strong>在运行时创建<strong>SpriteSheet</strong>实例。</p>
	</header>

	<div class="canvasHolder">
		<canvas id="testCanvas" width="960" height="400"></canvas>
	</div>
</body>
</html>
